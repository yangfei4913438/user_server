## 系统设计

一个相对完善的用户管理系统。包含了消息队列、缓存、数据库、jwt 等内容，

### 功能设计目标：

#### 用户管理
- [x] 用户注册：提供多种注册API（手机号和邮箱原理类似，因为成本问题，这里就不实现了）
  - [x] 邮箱 + 密码注册
  - [x] 用户名 + 密码注册
- [x] 用户认证：提供登录API，根据用户提供的认证信息生成JWT。
  - [x] jwt: 
    - [x] 一个用户只能登录 1 个设备。
    - [x] 双token认证，访问token有效期12小时，刷新token有效期7天。
    - [x] 有单独的刷新接口，更新token
  - [x] 登陆认证方式
    - [x] 邮箱+验证码
    - [x] 邮箱+密码
    - [x] 用户名+密码
- [x] 用户列表获取
- [x] 用户信息获取
- [x] 用户资料更新
- [x] 用户注销
  - [x] 注销账号功能，软删除。
  - [x] 注销后 30 天内，用户可以继续登录，登录自动解除注销操作。
  - [x] 30 天内未登录，定时器执行真实的账号删除。
- [x] 用户操作审计
  - [x] 账号注册成功
  - [x] 资料变更成功
  - [x] 注销成功
  - [x] 真实删除成功

#### 权限管理
- [x] 权限分类
  - [x] 浏览，浏览数据
  - [x] 创建，创建数据
  - [x] 编辑，修改数据
  - [x] 删除, 删除数据
  - [x] 管理, 给其他用户，增加权限，移除权限。查看其他用户的权限。
- [x] 角色分类
  - [x] 管理员：浏览、创建、编辑、删除、管理
  - [x] 编辑：浏览、编辑、删除
  - [x] 会员: 浏览、创建、编辑（自己创建的），删除（自己创建的）
  - [x] 游客: 浏览

### 技术栈
- Node.js with TypeScript：使用TypeScript编写Node.js应用，利用其静态类型检查提高代码质量。
- NestJS：利用NestJS的模块化、依赖注入和中间件功能，构建结构清晰的应用。
- MySQL：使用MySQL存储数据
- RabbitMQ：配置RabbitMQ用于处理邮件发送、审计日志记录等异步任务。
- Prisma：通过Prisma Migrate管理数据库迁移，确保开发和生产环境的一致性。
- Redis：配置Redis缓存用户信息和权限等数据，设置合适的缓存策略和过期时间。
- JWT：使用JWT进行用户认证，确保每个请求都携带有效的JWT（注册、登录接口除外）

### 安全性考虑
- 数据加密：使用 argon2 等算法对用户密码进行哈希存储。argon2的安全系数相比于常见的哈希算法，要高出很多。Argon2有三个变种：Argon2i, Argon2d, and Argon2id：
  - Argon2d是比较快的，被用于数据依赖的内存访问，这使得它对GPU破解攻击具有很高的抵抗力，适用于不受侧信道攻击威胁的应用程序（如加密货币）
  - Argon2i使用独立于数据的内存访问，这是密码散列和基于密码的密钥派生的首选方法，但速度较慢，因为它会在内存中进行更多的传递，以防止受到折衷攻击。
  - Argon2id是Argon2i和Argon2d的混合体，使用依赖于数据和独立于数据的内存访问的组合，这使Argon2i能够抵抗侧通道缓存计时攻击，并使Argon2d能够抵抗GPU破解攻击。
- 访问控制：使用NestJS的Guard功能实现基于角色的访问控制。
- 审计日志: 记录所有的增删改操作, 方便追溯操作记录。
